# å­—å¹•æ•°æ®æµè°ƒè¯•æŒ‡å—

## é—®é¢˜ç°è±¡

### å·²ä¿®å¤çš„é—®é¢˜ âœ…

1. **è¯­è¨€é€‰æ‹©ç¼“å­˜é—®é¢˜** (2024-11)
   - **é—®é¢˜**: åˆ‡æ¢è§†é¢‘æ—¶ï¼Œè¯­è¨€é€‰æ‹©ä¼šè¢«ç¼“å­˜ï¼Œå¯¼è‡´ç”¨é”™è¯¯çš„è¯­è¨€è¯†åˆ«æ–°è§†é¢‘
   - **ä¿®å¤**: åœ¨ `VideoDetail.tsx` ä¸­é‡ç½® `selectedVideoLanguage`
   - **æ–‡æ¡£**: `@docs/å­—å¹•è¯†åˆ«è¯­è¨€é—®é¢˜ä¿®å¤.md`

2. **ä¸­æ–‡å•å­—è¢«è¿‡æ»¤** (2024-11)
   - **é—®é¢˜**: Deepgram è¿”å›æ­£ç¡®çš„ä¸­æ–‡å•å­—ï¼Œä½†è¢« `deepgramToSegments` è¿‡æ»¤æ‰
   - **ä¿®å¤**: ä¿®æ”¹è¿‡æ»¤é€»è¾‘ï¼Œå…è®¸ä¸­æ–‡å­—ç¬¦ `\u4e00-\u9fa5` é€šè¿‡
   - **æ–‡æ¡£**: `@docs/ä¸­æ–‡å­—å¹•è¿‡æ»¤Bugä¿®å¤.md`

3. **ä¸­æ–‡å­—ç¬¦ä¹‹é—´åŠ ç©ºæ ¼** (2024-11)
   - **é—®é¢˜**: ç”Ÿæˆçš„ä¸­æ–‡å­—å¹•æ¯ä¸ªå­—ä¹‹é—´éƒ½æœ‰ç©ºæ ¼ï¼Œå¦‚ "æ‰© æ•£ æ¨¡ å‹"
   - **ä¿®å¤**: æ·»åŠ  `needsSpace` æ™ºèƒ½åˆ¤æ–­å‡½æ•°ï¼Œä¸­æ–‡ä¹‹é—´ä¸åŠ ç©ºæ ¼
   - **æ–‡æ¡£**: `@docs/ä¸­æ–‡å­—å¹•ç©ºæ ¼é—®é¢˜ä¿®å¤.md`

### å¾…æ’æŸ¥çš„é—®é¢˜ â³

ç”¨æˆ·æŠ¥å‘Šï¼š
- âœ… æ§åˆ¶å°ä¸­çœ‹åˆ°çš„å­—å¹•æ˜¯**æ­£ç¡®çš„ä¸­æ–‡**
- âŒ ä½†æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šçš„å­—å¹•æ˜¯**é”™è¯¯çš„å†…å®¹**
- âŒ å¯¼å‡ºçš„ SRT æ–‡ä»¶ä¹Ÿæ˜¯**é”™è¯¯çš„å†…å®¹**

**å…³é”®çº¿ç´¢ï¼š** SRT æ–‡ä»¶ä¹Ÿé”™è¯¯ï¼Œè¯´æ˜é—®é¢˜åœ¨**æ•°æ®è½¬æ¢é˜¶æ®µ**ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºå±‚ï¼

---

## ğŸ” æ•°æ®æµè¿½è¸ª

å­—å¹•æ•°æ®ç»è¿‡ä»¥ä¸‹æµç¨‹ï¼š

```
1. Deepgram API å“åº”
   â†“
2. deepgramToSegments() è½¬æ¢
   â†“
3. generateResilientSubtitles() å¤„ç†
   â†“
4. saveSubtitles() ä¿å­˜åˆ° IndexedDB
   â†“
5. App.tsx è¯»å–æ•°æ®
   â†“
6. VideoDetail ç»„ä»¶æ˜¾ç¤º
```

**é—®é¢˜å¯èƒ½å‡ºç°åœ¨æ­¥éª¤ 2-4 ä¹‹é—´ï¼**

---

## ğŸ§ª å®Œæ•´è°ƒè¯•æ­¥éª¤

### æ­¥éª¤ 1: æ¸…ç©ºæ§åˆ¶å°

ç‚¹å‡»æ§åˆ¶å°çš„ ğŸš« æŒ‰é’®æ¸…ç©ºæ‰€æœ‰æ—¥å¿—

### æ­¥éª¤ 2: é‡æ–°ç”Ÿæˆå­—å¹•

1. ç‚¹å‡»"é‡æ–°ç”Ÿæˆå­—å¹•"æŒ‰é’®
2. é€‰æ‹©"ä¸­æ–‡ (Chinese)"
3. ç­‰å¾…ç”Ÿæˆå®Œæˆ

### æ­¥éª¤ 3: æ£€æŸ¥æ§åˆ¶å°è¾“å‡º

ä½ åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹å…³é”®æ—¥å¿—ï¼ˆæŒ‰æ—¶é—´é¡ºåºï¼‰ï¼š

#### ğŸ“ æ£€æŸ¥ç‚¹ 1: Deepgram API å“åº”

```javascript
[Deepgram] Transcription complete (proxy mode)
[Deepgram] Response metadata: {...}
[Deepgram] Transcription summary:
  transcriptLength: 1234
  transcriptPreview: "åœ¨è¿™èŠ‚è¯¾æˆ‘ä»¬æ¥å­¦ä¹ ..."  // â† æ£€æŸ¥è¿™é‡Œï¼
  wordCount: 447
  firstWords: "åœ¨ è¿™ èŠ‚ è¯¾ æˆ‘ä»¬"          // â† æ£€æŸ¥è¿™é‡Œï¼
  lastWords: "..."

[Deepgram] ğŸ” Transcript ç¼–ç æ£€æŸ¥:
  å‰20å­—ç¬¦: "åœ¨è¿™èŠ‚è¯¾æˆ‘ä»¬æ¥å­¦ä¹ å¤§å‹è¯­è¨€æ¨¡å‹"
  å­—ç¬¦ç¼–ç : [22312, 36825, 33410, 35838, ...]  // â† åº”è¯¥æ˜¯ä¸­æ–‡ç¼–ç ï¼ˆå¤§äº 19968ï¼‰
  æ˜¯å¦åŒ…å«ä¸­æ–‡: true                             // â† åº”è¯¥æ˜¯ true
  æ˜¯å¦åŒ…å«è‹±æ–‡: false                            // â† åº”è¯¥æ˜¯ falseï¼ˆå¦‚æœæ˜¯ä¸­æ–‡è§†é¢‘ï¼‰
```

**âœ… å¦‚æœè¿™é‡Œæ˜¾ç¤ºä¸­æ–‡ â†’ Deepgram è¯†åˆ«æ­£ç¡®**
**âŒ å¦‚æœè¿™é‡Œæ˜¾ç¤ºè‹±æ–‡ â†’ Deepgram è¯†åˆ«é”™è¯¯ï¼ˆè¯­è¨€å‚æ•°é—®é¢˜ï¼‰**

---

#### ğŸ“ æ£€æŸ¥ç‚¹ 2: å•è¯å¤„ç†

```javascript
[Deepgram] ğŸ” å‰5ä¸ªå•è¯è¯¦ç»†ä¿¡æ¯:
  å•è¯ 1: {
    åŸå§‹å€¼: "åœ¨",
    ç±»å‹: "string",
    é•¿åº¦: 1,
    å­—ç¬¦ç¼–ç : [22312],              // â† æ£€æŸ¥ç¼–ç å€¼
    æ—¶é—´: "0.00s - 0.20s"
  }
  å•è¯ 2: {
    åŸå§‹å€¼: "è¿™",
    å­—ç¬¦ç¼–ç : [36825],              // â† æ£€æŸ¥ç¼–ç å€¼
    ...
  }
```

**å…³é”®æ£€æŸ¥ï¼š**
- åŸå§‹å€¼æ˜¯å¦æ­£ç¡®ï¼Ÿ
- å­—ç¬¦ç¼–ç æ˜¯å¦æ­£ç¡®ï¼Ÿ
  - ä¸­æ–‡å­—ç¬¦åº”è¯¥åœ¨ `19968-40959` èŒƒå›´
  - è‹±æ–‡å­—æ¯ç¼–ç åœ¨ `65-122` èŒƒå›´

---

#### ğŸ“ æ£€æŸ¥ç‚¹ 3: ç‰‡æ®µç”Ÿæˆ

```javascript
[Deepgram] ğŸ” å‰3ä¸ªç”Ÿæˆçš„ç‰‡æ®µ:
  ç‰‡æ®µ 1: {
    æ–‡æœ¬: "åœ¨ è¿™ èŠ‚ è¯¾ æˆ‘ä»¬ æ¥ å­¦ä¹ ",     // â† æ£€æŸ¥è¿™é‡Œï¼
    æ–‡æœ¬é•¿åº¦: 14,
    å­—ç¬¦ç¼–ç : [22312, 32, 36825, ...],  // â† æ£€æŸ¥ç¼–ç 
    æ—¶é—´: "0.00s - 5.00s"
  }
```

**âœ… å¦‚æœè¿™é‡Œæ˜¾ç¤ºä¸­æ–‡ â†’ è½¬æ¢æ­£ç¡®**
**âŒ å¦‚æœè¿™é‡Œæ˜¾ç¤ºè‹±æ–‡ â†’ è½¬æ¢é”™è¯¯ï¼ˆbug åœ¨ deepgramToSegmentsï¼‰**

---

#### ğŸ“ æ£€æŸ¥ç‚¹ 4: ä¿å­˜åˆ° IndexedDB

```javascript
===== å‡†å¤‡ä¿å­˜å­—å¹•åˆ° IndexedDB =====
å­—å¹•ç‰‡æ®µæ•°: 447
ç¬¬1æ¡å­—å¹•:
  æ–‡æœ¬: "åœ¨ è¿™ èŠ‚ è¯¾ æˆ‘ä»¬ æ¥ å­¦ä¹ "      // â† æ£€æŸ¥è¿™é‡Œï¼
  æ–‡æœ¬é•¿åº¦: 14
  å­—ç¬¦ç¼–ç : [22312, 32, 36825, ...]   // â† æ£€æŸ¥ç¼–ç 
  ç±»å‹: string

âœ… å­—å¹•å·²ä¿å­˜åˆ°æœ¬åœ° IndexedDB

===== ä» IndexedDB è¯»å–éªŒè¯ =====
ç¬¬1æ¡å­—å¹•: "åœ¨ è¿™ èŠ‚ è¯¾ æˆ‘ä»¬ æ¥ å­¦ä¹ "    // â† æ£€æŸ¥è¿™é‡Œï¼
æ˜¯å¦ç›¸åŒ: true                          // â† åº”è¯¥æ˜¯ true
```

**âœ… å¦‚æœ"æ˜¯å¦ç›¸åŒ: true" â†’ IndexedDB å­˜å‚¨æ­£ç¡®**
**âŒ å¦‚æœ"æ˜¯å¦ç›¸åŒ: false" â†’ IndexedDB å­˜å‚¨é”™è¯¯ï¼ˆç¼–ç é—®é¢˜ï¼‰**

---

#### ğŸ“ æ£€æŸ¥ç‚¹ 5: ç»„ä»¶æ¥æ”¶æ•°æ®

```javascript
===== VideoDetail ç»„ä»¶æ¥æ”¶åˆ°çš„å­—å¹• =====
å­—å¹•ç‰‡æ®µæ•°: 447
ç¬¬1æ¡å­—å¹•:
  æ–‡æœ¬: "åœ¨ è¿™ èŠ‚ è¯¾ æˆ‘ä»¬ æ¥ å­¦ä¹ "      // â† æ£€æŸ¥è¿™é‡Œï¼
  æ–‡æœ¬é•¿åº¦: 14
  å­—ç¬¦ç¼–ç : [22312, 32, 36825, ...]   // â† æ£€æŸ¥ç¼–ç 
  ç±»å‹: string
```

**âœ… å¦‚æœè¿™é‡Œæ˜¾ç¤ºä¸­æ–‡ â†’ æ•°æ®ä¼ é€’æ­£ç¡®ï¼Œé—®é¢˜åœ¨æ¸²æŸ“å±‚**
**âŒ å¦‚æœè¿™é‡Œæ˜¾ç¤ºè‹±æ–‡ â†’ æ•°æ®ä¼ é€’é”™è¯¯**

---

## ğŸ¯ æ ¹æ®æ£€æŸ¥ç»“æœå®šä½é—®é¢˜

### åœºæ™¯ A: æ£€æŸ¥ç‚¹ 1 å°±é”™äº†ï¼ˆDeepgram å“åº”é”™è¯¯ï¼‰

**é—®é¢˜ï¼š** è¯­è¨€å‚æ•°è®¾ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ä½ é€‰æ‹©äº†æ­£ç¡®çš„è¯­è¨€ï¼ˆä¸­æ–‡è§†é¢‘é€‰"ä¸­æ–‡"ï¼‰
2. æ£€æŸ¥æ§åˆ¶å°ä¸­çš„è¯­è¨€å‚æ•°æ—¥å¿—ï¼š
   ```
   [Deepgram] ğŸŒ Language specified: { input: 'zh', normalized: 'zh' }
   ```
3. å¦‚æœçœ‹åˆ° `Language auto-detection enabled`ï¼Œè¯´æ˜æ²¡æœ‰ä¼ é€’è¯­è¨€å‚æ•°
4. æ£€æŸ¥ `selectedVideoLanguage` æ˜¯å¦æ­£ç¡®

---

### åœºæ™¯ B: æ£€æŸ¥ç‚¹ 1 æ­£ç¡®ï¼Œæ£€æŸ¥ç‚¹ 3 é”™è¯¯

**é—®é¢˜ï¼š** `deepgramToSegments` å‡½æ•°è½¬æ¢æ—¶å‡ºé”™

**å¯èƒ½åŸå› ï¼š**
1. `word.word` å­—æ®µè¢«é”™è¯¯å¤„ç†
2. å­—ç¬¦ä¸²æ‹¼æ¥æ—¶ç¼–ç è¢«ç ´å
3. è¿‡æ»¤é€»è¾‘è¯¯åˆ äº†æ­£ç¡®çš„å•è¯

**è°ƒè¯•æ–¹æ³•ï¼š**
åœ¨ `deepgramToSegments` å‡½æ•°ä¸­æ·»åŠ  `console.log`ï¼š

```typescript
// ç¬¬ 1023 è¡Œ
text: validWords[0].word,  // â† æ·»åŠ  console.log æ£€æŸ¥è¿™é‡Œ

// ç¬¬ 1048 è¡Œ
currentSegment.text += ' ' + word.word;  // â† æ·»åŠ  console.log æ£€æŸ¥è¿™é‡Œ
```

---

### åœºæ™¯ C: æ£€æŸ¥ç‚¹ 3 æ­£ç¡®ï¼Œæ£€æŸ¥ç‚¹ 4 é”™è¯¯

**é—®é¢˜ï¼š** IndexedDB å­˜å‚¨æ—¶ç¼–ç è¢«ç ´å

**å¯èƒ½åŸå› ï¼š**
1. IndexedDB ä¸æ”¯æŒæŸäº›å­—ç¬¦ç¼–ç 
2. æ•°æ®åºåˆ—åŒ–æ—¶å‡ºé”™

**è§£å†³æ–¹æ¡ˆï¼š**
åœ¨ `dbService.ts` ä¸­æ·»åŠ ç¼–ç è½¬æ¢ï¼š

```typescript
async put(subtitles: Subtitles) {
  // ç¡®ä¿æ–‡æœ¬æ˜¯ UTF-8 ç¼–ç 
  const sanitized = {
    ...subtitles,
    segments: subtitles.segments.map(seg => ({
      ...seg,
      text: seg.text // å·²ç»æ˜¯æ­£ç¡®çš„ string
    }))
  };
  return (await dbPromise).put('subtitles', sanitized);
}
```

---

### åœºæ™¯ D: æ£€æŸ¥ç‚¹ 4 æ­£ç¡®ï¼Œæ£€æŸ¥ç‚¹ 5 é”™è¯¯

**é—®é¢˜ï¼š** ä» IndexedDB è¯»å–åæ•°æ®è¢«ç ´å

**æ£€æŸ¥æ–‡ä»¶ï¼š** `App.tsx` ä¸­çš„æ•°æ®åŠ è½½é€»è¾‘

---

### åœºæ™¯ E: æ‰€æœ‰æ£€æŸ¥ç‚¹éƒ½æ­£ç¡®ï¼Œä½†é¡µé¢æ˜¾ç¤ºé”™è¯¯

**é—®é¢˜ï¼š** React æ¸²æŸ“æˆ– CSS é—®é¢˜

**è°ƒè¯•æ–¹æ³•ï¼š**
1. åœ¨é¡µé¢ä¸Šé€‰ä¸­é”™è¯¯çš„å­—å¹•æ–‡æœ¬
2. å³é”® â†’ æ£€æŸ¥å…ƒç´ 
3. æŸ¥çœ‹ HTML ä¸­çš„å®é™…å†…å®¹
4. æ£€æŸ¥æ˜¯å¦æœ‰ CSS `text-transform` ç­‰æ ·å¼å½±å“

---

## ğŸ“‹ è¯·æä¾›çš„ä¿¡æ¯

ä¸ºäº†å¸®ä½ ç²¾ç¡®å®šä½é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. **å®Œæ•´çš„æ§åˆ¶å°æˆªå›¾**ï¼ˆåŒ…å«æ‰€æœ‰æ£€æŸ¥ç‚¹ï¼‰
2. **é—®é¢˜å‡ºç°åœ¨å“ªä¸ªæ£€æŸ¥ç‚¹ï¼Ÿ**
   - æ£€æŸ¥ç‚¹ 1ï¼ˆDeepgram å“åº”ï¼‰
   - æ£€æŸ¥ç‚¹ 2ï¼ˆå•è¯å¤„ç†ï¼‰
   - æ£€æŸ¥ç‚¹ 3ï¼ˆç‰‡æ®µç”Ÿæˆï¼‰
   - æ£€æŸ¥ç‚¹ 4ï¼ˆIndexedDB ä¿å­˜ï¼‰
   - æ£€æŸ¥ç‚¹ 5ï¼ˆç»„ä»¶æ¥æ”¶ï¼‰

3. **å¯¹æ¯”ä¿¡æ¯ï¼š**
   ```
   Deepgram è¿”å›çš„ç¬¬ä¸€ä¸ªå•è¯: "åœ¨"
   deepgramToSegments ç”Ÿæˆçš„ç¬¬ä¸€æ¡å­—å¹•: "???"
   IndexedDB ä¿å­˜çš„ç¬¬ä¸€æ¡å­—å¹•: "???"
   é¡µé¢æ˜¾ç¤ºçš„ç¬¬ä¸€æ¡å­—å¹•: "???"
   ```

4. **å­—ç¬¦ç¼–ç ä¿¡æ¯ï¼š**
   ```
   Deepgram è¿”å›: [22312, 36825, ...]  (æ­£ç¡®çš„ä¸­æ–‡ç¼–ç )
   æœ€ç»ˆæ˜¾ç¤º: [???, ???, ...]           (å®é™…æ˜¾ç¤ºçš„ç¼–ç )
   ```

---

## ğŸ”§ ä¸´æ—¶éªŒè¯æ–¹æ³•

å¦‚æœä½ æƒ³å¿«é€ŸéªŒè¯æŸä¸ªç¯èŠ‚ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°æ‰‹åŠ¨æ‰§è¡Œï¼š

### éªŒè¯ IndexedDB ä¸­çš„æ•°æ®

```javascript
const request = indexedDB.open('LocalVideoAnalyzerDB', 4);
request.onsuccess = (event) => {
  const db = event.target.result;
  const tx = db.transaction('subtitles', 'readonly');
  const store = tx.objectStore('subtitles');
  store.getAll().onsuccess = (e) => {
    const subtitles = e.target.result;
    console.log('IndexedDB ä¸­çš„ç¬¬ä¸€æ¡å­—å¹•:', subtitles[0]?.segments[0]);
  };
};
```

### éªŒè¯ Deepgram å“åº”ï¼ˆéœ€è¦åœ¨ç½‘ç»œè¯·æ±‚ä¸­æŸ¥çœ‹ï¼‰

1. æ‰“å¼€ Network æ ‡ç­¾
2. è¿‡æ»¤ "listen" æˆ– "deepgram"
3. ç‚¹å‡»è¯·æ±‚ â†’ Preview/Response
4. æŸ¥çœ‹ `results.channels[0].alternatives[0].transcript`

---

## ğŸ¯ ä¸‹ä¸€æ­¥

è¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤é‡æ–°ç”Ÿæˆå­—å¹•ï¼Œå¹¶æä¾›ï¼š
1. å®Œæ•´æ§åˆ¶å°æˆªå›¾
2. é—®é¢˜å‡ºç°åœ¨å“ªä¸ªæ£€æŸ¥ç‚¹
3. å­—ç¬¦ç¼–ç å¯¹æ¯”ä¿¡æ¯

è¿™æ ·æˆ‘å°±èƒ½ç²¾ç¡®å®šä½é—®é¢˜å¹¶æä¾›è§£å†³æ–¹æ¡ˆï¼ğŸš€

